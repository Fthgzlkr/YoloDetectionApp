@{
    ViewData["Title"] = "YOLO Nesne Tespiti";
}

<div class="container mt-5">
    <h2 class="text-center mb-4">YOLO Nesne Tespiti</h2>

    <!-- Yükleme Kartı -->
    <div class="card shadow-sm p-4">
        <h4 class="mb-3">Görüntü Yükleme ve İşleme</h4>
        <form method="post" enctype="multipart/form-data" asp-action="UploadImages" id="uploadForm">
            <div class="mb-3">
                <input type="file" class="form-control" name="uploadedFiles" id="uploadedFiles" accept="image/*" multiple onchange="previewImages(event)">
            </div>
            <button type="submit" class="btn btn-primary w-100">Fotoğrafları Yükle ve İşle</button>
        </form>

        <!-- Yükleme Animasyonu -->
        <div id="loading" style="display: none;" class="text-center mt-3">
            <div class="spinner-border text-primary" role="status"></div>
            <span>İşleniyor, lütfen bekleyin...</span>
        </div>
    </div>

    <!-- Önizleme Galerisi -->
    <h3 class="mt-4">Yüklenen Resimler:</h3>
    <div class="row mt-2" id="previewGallery"></div>

    <!-- Sonuç Galerisi -->
    <h3 class="mt-4">İşlenmiş Resimler:</h3>
    <div class="row mt-2" id="resultGallery">
        @if (ViewBag.ProcessedImages != null)
        {
            @foreach (var imagePath in ViewBag.ProcessedImages)
            {
                <div class="col-md-3 img-card">
                    <img src="@imagePath" class="result-img rounded" onclick="showModal('@imagePath')">
                    <p>@System.IO.Path.GetFileName(imagePath)</p>
                </div>
            }
        }
    </div>
</div>

<!-- Stil -->
<style>
    .preview-img, .result-img {
        height: 150px;
        object-fit: cover;
        cursor: pointer;
        transition: transform 0.2s ease;
    }

        .preview-img:hover, .result-img:hover {
            transform: scale(1.05);
        }

    .modal-img {
        width: 100%;
        height: auto;
    }

    .img-card {
        margin: 10px;
        border: 1px solid #ddd;
        padding: 5px;
        text-align: center;
    }

    body {
        background-color: #f8f9fa;
    }
</style>

<!-- Resim Büyütme Modal -->
<div class="modal fade" id="imageModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-body">
                <img id="modalImage" class="modal-img">
            </div>
        </div>
    </div>
</div>

<!-- Script -->
<script>
    function previewImages(event) {
        const files = event.target.files;
        const gallery = document.getElementById('previewGallery');
        gallery.innerHTML = '';

        for (let i = 0; i < files.length; i++) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const div = document.createElement('div');
                div.classList.add('col-md-3', 'img-card');
                div.innerHTML = `
                    <img src="${e.target.result}" class="preview-img rounded" onclick="showModal('${e.target.result}')">
                    <p>${files[i].name}</p>
                `;
                gallery.appendChild(div);
            };
            reader.readAsDataURL(files[i]);
        }
    }

    function showModal(src) {
        const modal = new bootstrap.Modal(document.getElementById('imageModal'));
        const modalImage = document.getElementById('modalImage');
        modalImage.src = src;
        modal.show();
    }

    const form = document.getElementById('uploadForm');
    const loading = document.getElementById('loading');
    form.addEventListener('submit', function() {
        loading.style.display = 'block';
    });
</script>
